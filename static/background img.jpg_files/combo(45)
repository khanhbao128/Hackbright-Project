YUI.add("gallery-photo-association-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,attributes:{id:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},galleryId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},photoId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry"],langBundles:["models"]});YUI.add("flickr-galleries-removePhoto-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-galleries-removePhoto"]={run:function(t,l){var s={full_response:1},r=t.galleryCompoundID?t.galleryCompoundID.split("-").pop():t.galleryID;return s.photo_id=t.photoID,s.gallery_id=r,o.Promise.all([l.callAPI("flickr.galleries.removePhoto",s),l.getModel("gallery-models",r),l.getModel("photo-models",t.photoID),l.getModelRegistry("photo-galleries-models"),l.getModelRegistry("photo-contexts-models"),l.getModelRegistry("gallery-info-models"),l.getModelRegistry("gallery-photo-association-models")]).then(function(o){var e,l=o[0],s=o[1],a=o[2],i=o[3],u=o[4],g=o[5],h=o[6];if("ok"===l.stat)return e=l.gallery,s&&(s.hasPhoto(a.getValue("id"))&&s.removePhoto(a),s.setValue("photoCount",e.countPhotos),s.setValue("videoCount",e.countVideos),s.getValue("photoCount")+s.getValue("videoCount")===0&&(s.setValue("primary",null),s.setValue("primaryPhotoSizes",{}))),g.exists(r)&&g.hasPhoto(r,a.getValue("id"))&&(g.getValue(r,"photoList").removeFromList(a.getValue("id")),g.setValue(r,"photoCount",e.countPhotos),g.setValue(r,"videoCount",e.countVideos),g.getValue(r,"photoList").totalItems=e.countPhotos+e.countVideos||0,g.setValue(r,"primaryPhotoId",e.primaryPhotoId),g.setValue(r,"currentState",e.current_state)),u.exists(t.photoID)&&u.getValue(t.photoID,"contexts").getFromListByID(r)&&(u.setValue(t.photoID,"totalGalleries",u.getValue(t.photoID,"totalGalleries")-1),u.getValue(t.photoID,"contexts").removeFromList(r)),i.exists(t.photoID)&&i.getValue(t.photoID,"galleries").getFromListByID(r)&&(i.setValue(t.photoID,"total",i.getValue(t.photoID,"total")-1),i.getValue(t.photoID,"galleries").removeFromList(r)),h.exists(r+"-"+t.photoID)&&h.remove(r+"-"+t.photoID),s},o.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:["gallery-models","photo-models","photo-galleries-models","photo-contexts-models","gallery-info-models","gallery-photo-association-models"]});YUI.add("flickr-galleries-setPrimaryPhoto-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-setPrimaryPhoto"]={run:function(l,i){var t={};return t.gallery_id=l.galleryId,t.primary_photo_id=l.photoId,i.callAPI("flickr.galleries.setPrimaryPhoto",t).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"]});YUI.add("flickr-galleries-editPhotos-updater",function(r,e){"use strict";r.namespace("ModelUpdaters")["flickr-galleries-editPhotos"]={run:function(o,t){var i={gallery_id:o.galleryId,primary_photo_id:o.primaryPhotoId};return o.photoIds&&o.photoIds.length>0&&(i.photo_ids=o.photoIds.join(",")),t.callAPI("flickr.galleries.editPhotos",i).then(null,r.FetcherErrorLogger(e))}}},"@VERSION@",{requires:[]});YUI.add("flickr-galleries-reorderPhotos-updater",function(e,r){"use strict";e.namespace("ModelUpdaters")["flickr-galleries-reorderPhotos"]={run:function(r,t){var l={gallery_id:r.galleryId,photo_ids:JSON.stringify(r.photoIds),user_id:r.userId,current_state:r.currentState};return e.Promise.all([t.callAPI("flickr.galleries.reorderPhotos",l),t.getModel("gallery-info-models",r.galleryId),t.getModelRegistry("gallery-models")]).then(function(e){var t=e[0],l=e[1],o=e[2];if(l.setValue("currentState",t.currentState),o.exists(r.galleryId)){var a=o.getValue(r.galleryId,"photoContextList");a.getList().forEach(function(e){a.removeFromList(e.id)})}})}}},"@VERSION@",{requires:[],optional:["gallery-info-models"]});YUI.add("flickr-galleries-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-galleries-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.galleries.getContext",this._processParams(t),!0),s.getModelRegistry("gallery-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"Photo not in gallery"===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){return{gallery_id:o.compoundId||o.id,photo_id:o.photoId,extras:e.APIHelper.request.getRebootPhotoExtras(),num_prev:o.numPrev,num_next:o.numNext,user_id:o.ownerId}},_processResponse:function(o,t){var s,r,n,l,p,a,i=o[0],d=o[1],g=o[2],h=o[3],u=o[4],m=o[5],c=[],y=[],x=g.proxy(t.photoId),M=[];return s=i.nextphotos,r=i.prevphotos,y=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:h,photoModelRegistry:g,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=d.getValue(t.id,"photoContextList"),l=!!a.hasMinBoundary&&a.hasMinBoundary(),p=!!a.hasMaxBoundary&&a.hasMaxBoundary(),n=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:x,next:y,prev:c.reverse(),current:n,hasMin:l,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),d.setValue(t.id,"photoContextList",M),{next:y,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["gallery-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});